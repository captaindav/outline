name: drupal-outline
recipe: drupal9
config:
  webroot: drupal/web
  php: '7.4'
  xdebug: true
services:
  drupaltest:
    type: mysql
    creds:
      user:  drupaltest
      password: drupaltest
      database: drupaltest
  appserver:
    overrides:
      environment:
        SIMPLETEST_BASE_URL: "http://drupal-outline.lndo.site"
        SIMPLETEST_DB: "mysql://drupaltest:drupaltest@drupaltest:3306/drupaltest"
  node:
    type: node:10
    ssl: false
    command: tail -f /dev/null
    port: 3000
  mailhog:
    type: mailhog
    hogfrom:
      - appserver
node:
  service: node
npm:
  service: node
proxy:
  mailhog:
    - mail.drupal-outline.lndo.site
tooling:
  testEntryDelete:
    service: appserver
    cmd: "php /app/drupal/vendor/bin/phpunit -c /app/phpunit.xml /app/drupal/web/modules/outline/tests/src/Kernel/EntryKernelTest.php --filter='testEntryDelete'"
  install-outline:
    service: appserver
    description: "Install the Drupal Outline module for development."
    cmd:
      - git clone --branch 8.x-1.x git@git.drupal.org:project/outline.git && cd web/modules && ln -s ../../outline outline
  install-settings:
    service: appserver
    description: "Install the Drupal Outline module for development."
    cmd:
      - cp ../scripts/settings/settings.php web/sites/default
      - cp ../scripts/settings/services.yml web/sites/default
  install-core:
    service: appserver
    description: "Install Drupal 9 Core."
    cmd:
      - drush -y site-install standard --account-pass admin --site-name "Drupal Outline" --db-url mysql://drupal9:drupal9@database/drupal9
  install-modules:
    service: appserver
    description: "Install Drupal 9 modules."
    cmd:
      - drush -y en content_moderation, media, media_library, workflows
      - drush -y en admin_toolbar, admin_toolbar_tools, admin_toolbar_links_access_filter, admin_toolbar_search
      - drush -y en ctools, devel, graphql, paragraphs, pathauto, token
